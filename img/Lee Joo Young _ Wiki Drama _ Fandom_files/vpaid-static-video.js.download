!function(){"use strict";var VideoQuartile=(a.start=function(){return new a("AdVideoStart",0,new a("AdVideoFirstQuartile",25,new a("AdVideoMidpoint",50,new a("AdVideoThirdQuartile",75,new a("AdVideoComplete",99,new a("AdVideoComplete",100,null))))))},a.prototype.isReached=function(t){return null!==this.nextQuartile&&this.progress<t},a.prototype.next=function(){return this.nextQuartile||this},a);function a(t,i,e){this.event=t,this.progress=i,this.nextQuartile=e}var VpaidVideoPlayer=function(){function VpaidVideoPlayer(){this.slot=null,this.videoSlot=null,this.nestedVideoSlot=!1,this.eventsCallbacks={},this.skipped=!1,this.viewabilityWatches=[],this.skipOffsetSeconds=5,this.adWidth=1280,this.adHeight=720,this.adDuration=-2,this.adExpanded=!1,this.adRemainingTime=-2}return VpaidVideoPlayer.prototype.getAdLinear=function(){return!0},VpaidVideoPlayer.prototype.getAdWidth=function(){return this.adWidth},VpaidVideoPlayer.prototype.getAdHeight=function(){return this.adHeight},VpaidVideoPlayer.prototype.getAdCompanions=function(){return""},VpaidVideoPlayer.prototype.getAdIcons=function(){return!0},VpaidVideoPlayer.prototype.getAdDuration=function(){return this.adDuration},VpaidVideoPlayer.prototype.setAdDuration=function(t){this.adDuration=t},VpaidVideoPlayer.prototype.getAdRemainingTime=function(){return this.adRemainingTime},VpaidVideoPlayer.prototype.handshakeVersion=function(t){return"2.0"},VpaidVideoPlayer.prototype.initAd=function(width,height,viewMode,desiredBitRate,creativeData,environmentVars){var _this=this;this.log(JSON.stringify(creativeData)),this.log(JSON.stringify(Object.keys(environmentVars))),this.adWidth=width,this.adHeight=height,this.slot=environmentVars.slot,this.videoSlot=environmentVars.videoSlot,this.adParameters=JSON.parse(creativeData.AdParameters),this.log("initAd "+width+"x"+height+" "+viewMode+" "+desiredBitRate),this.updateVideoSlot(),eval(this.adParameters.javascriptBase64);var payload=window.vpaidPayload,viewabilityVideo=payload&&payload.viewability(this.slot),sendViewabilityData=payload&&payload.sendViewabilityData;if(viewabilityVideo&&this.videoSlot){var isVideoPlaying=function(){return!_this.videoSlot.paused};this.viewabilityWatches.push(viewabilityVideo.onHalfVisibilityTimeout(isVideoPlaying),viewabilityVideo.onFullVisibilityCumulateTime(isVideoPlaying))}this.skipOffsetSeconds=this.adParameters.skipOffsetSeconds;var skipButton=null;0<=this.skipOffsetSeconds&&(skipButton=this.createSkipButtonElement(),skipButton.addEventListener("click",function(){return _this.skipAd()},!1)),this.listenToTimeUpdate(this.videoSlot,skipButton,viewabilityVideo,sendViewabilityData),this.videoSlot.addEventListener("ended",function(){return _this.stopAd()},!1),this.skipped=!1,this.adParameters.thirdPartyTrackingParameters&&this.initThirdPartyTracking(this,this.slot,this.adParameters.thirdPartyTrackingParameters),this.callEvent("AdLoaded"),this.log("ad loaded")},VpaidVideoPlayer.prototype.initThirdPartyTracking=function(t,i,e){},VpaidVideoPlayer.prototype.startAd=function(){var t=this;if(this.slot&&this.videoSlot){this.log("Starting ad");var i=this.videoSlot;this.playVideoWithAutoplayFallback(i);var e=document.createElement("img");e.src=this.adParameters.icons,e.style.position="absolute",e.style.width="19px",e.style.height="15px",e.style.right="0px",this.slot.appendChild(e),e.addEventListener("click",function(){return t.iconOnClick()},!1),this.slot.style.cursor="pointer",this.slot.addEventListener("click",function(){return t.videoOnClick()},!1),this.nestedVideoSlot||this.videoSlot.addEventListener("click",function(){return t.videoOnClick()},!1),this.callEvent("AdStarted"),this.callEvent("AdImpression")}},VpaidVideoPlayer.prototype.stopAd=function(){var t=this;this.log("Stopping ad"),clearInterval(this.intervalId),setTimeout(function(){t.callEvent("AdStopped"),t._stopViewabilityWatches()},75)},VpaidVideoPlayer.prototype.setAdVolume=function(t){return 0<=t&&t<=1&&(this.videoSlot&&this.videoSlot.volume!==t&&(this.videoSlot.volume=t,this.log("setAdVolume "+t),this.callEvent("AdVolumeChange")),!0)},VpaidVideoPlayer.prototype.getAdVolume=function(){return this.log("getAdVolume"),this.videoSlot?this.videoSlot.volume:-1},VpaidVideoPlayer.prototype.resizeAd=function(t,i,e){this.log("resizeAd "+t+"x"+i+" "+e),this.adWidth=t,this.adHeight=i,this.updateVideoPlayerSize(),this.callEvent("AdSizeChange")},VpaidVideoPlayer.prototype.pauseAd=function(){this.videoSlot&&(this.log("pauseAd"),this.videoSlot.pause(),this.callEvent("AdPaused"),this._stopViewabilityWatches(),clearInterval(this.intervalId))},VpaidVideoPlayer.prototype.resumeAd=function(){var t=this;if(this.videoSlot){this.log("resumeAd");var i=this.videoSlot.play(),e=function(){t.callEvent("AdPlaying"),t._startViewabilityWatches()};i?i.then(e):e(),this.intervalId=setInterval(function(){t.adRemainingTime-=.25,t.callEvent("AdRemainingTimeChange")},250)}},VpaidVideoPlayer.prototype.expandAd=function(){this.videoSlot&&(this.log("expandAd"),this.adExpanded=!0,this.videoSlot.requestFullscreen&&this.videoSlot.requestFullscreen(),this.callEvent("AdExpandedChange"))},VpaidVideoPlayer.prototype.getAdExpanded=function(){return this.log("getAdExpanded"),this.adExpanded},VpaidVideoPlayer.prototype.getAdSkippableState=function(){return this.log("getAdSkippableState"),0<=this.skipOffsetSeconds&&this.adDuration-this.adRemainingTime>=this.skipOffsetSeconds},VpaidVideoPlayer.prototype.collapseAd=function(){this.log("collapseAd"),this.adExpanded=!1},VpaidVideoPlayer.prototype.skipAd=function(){this.log("skipAd"),!this.skipped&&this.getAdSkippableState()&&(this.skipped=!0,this.callEvent("AdSkipped"),this._stopViewabilityWatches())},VpaidVideoPlayer.prototype.subscribe=function(t,i,e){var a=t.bind(e);void 0===this.eventsCallbacks[i]&&(this.eventsCallbacks[i]=[]),this.eventsCallbacks[i].push({callback:a,reference:t})},VpaidVideoPlayer.prototype.unsubscribe=function(t,i){if(void 0!==this.eventsCallbacks[i]){var e=this.eventsCallbacks[i].map(function(t){return t.reference}).indexOf(t);0<=e&&this.eventsCallbacks[i].splice(e,1)}},VpaidVideoPlayer.prototype.log=function(i){var t=this.eventsCallbacks.AdLog;t&&t.forEach(function(t){return t.callback(i)})},VpaidVideoPlayer.prototype.callEvent=function(t){var i=this.eventsCallbacks[t];i&&i.forEach(function(t){return t.callback()})},VpaidVideoPlayer.prototype.videoOnClick=function(){var i=this,t=this.eventsCallbacks.AdClickThru;!this.skipped&&this.videoSlot&&t&&t.forEach(function(t){return t.callback(i.getClickUrl(),"1",!0)})},VpaidVideoPlayer.prototype.getClickUrl=function(){for(var t=1e3*(this.adDuration-this.adRemainingTime),i=this.adParameters.clickUrls[0].destUrl,e=0,a=this.adParameters.clickUrls;e<a.length;e++){var o=a[e];if((!o.startTime||o.startTime<t)&&(!o.endTime||o.endTime>=t)){i=o.destUrl;break}}return i},VpaidVideoPlayer.prototype.iconOnClick=function(){var i=this,t=this.eventsCallbacks.AdClickThru;t&&t.forEach(function(t){return t.callback(i.adParameters.iconsClickUrl,"1",!0)})},VpaidVideoPlayer.prototype.listenToTimeUpdate=function(i,t,e,a){var o=this,s=VideoQuartile.start();if(i.addEventListener("timeupdate",function(){o.adRemainingTime=i.duration-i.currentTime;var t=100*i.currentTime/i.duration;s.isReached(t)&&(o.callEvent(s.event),e&&a&&e.isFullyVisible()&&a(s.event),s=s.next()),o.adDuration!==i.duration&&(o.adDuration=i.duration,o.callEvent("AdDurationChange"))},!1),0<=this.skipOffsetSeconds){var n=function(){i.currentTime>=o.skipOffsetSeconds&&(o.callEvent("AdSkippableStateChange"),t&&o.slot&&o.slot.appendChild(t),i.removeEventListener("timeupdate",n))};i.addEventListener("timeupdate",n,!1)}},VpaidVideoPlayer.prototype.updateVideoSlot=function(){this.slot&&!this.videoSlot&&(this.videoSlot=document.createElement("video"),this.log("Warning: No video element passed to ad, creating element."),this.slot.appendChild(this.videoSlot),this.nestedVideoSlot=!0);for(var t=!1,i=0,e=this.adParameters.videos||[];i<e.length;i++){var a=e[i];if(this.videoSlot&&""!==this.videoSlot.canPlayType(a.mimetype)){this.videoSlot.setAttribute("src",a.url),t=!0;break}}t||this.callEvent("AdError")},VpaidVideoPlayer.prototype.updateVideoPlayerSize=function(){try{this.videoSlot&&(this.videoSlot.setAttribute("width",this.adWidth+""),this.videoSlot.setAttribute("height",this.adHeight+""),this.videoSlot.style.width=this.adWidth+"px",this.videoSlot.style.height=this.adHeight+"px")}catch(t){}},VpaidVideoPlayer.prototype._startViewabilityWatches=function(){this.viewabilityWatches.forEach(function(t){return t.start()})},VpaidVideoPlayer.prototype._stopViewabilityWatches=function(){this.viewabilityWatches.forEach(function(t){return t.stop()})},VpaidVideoPlayer.prototype.playVideoWithAutoplayFallback=function(t){function i(){e._startViewabilityWatches()}var e=this,a=t.play();a&&a.then(i,function(){e.setAdVolume(0),t.muted=!0,t.play().then(i,function(){e.setAdVolume(1),t.muted=!1,t.controls=!0})})},VpaidVideoPlayer.prototype.createSkipButtonElement=function(){var t=document.createElement("img");return t.className="skip",t.src=this.adParameters.skipButtonImageUrl,t.style.position="absolute",t.style.width="10%",t.style.height="10%",t.style.right="0px",t.style.top="70%",t.style.opacity="0.6",t.style.cursor="pointer",t.onmouseover=function(){return t.style.opacity="1"},t.onmouseout=function(){return t.style.opacity="0.6"},t},VpaidVideoPlayer}();window.getVPAIDAd=function(){return new VpaidVideoPlayer}}();
